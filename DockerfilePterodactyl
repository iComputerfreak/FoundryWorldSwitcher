# ================================
# Setup Container
# ================================
FROM swift:6.0-jammy as build

MAINTAINER Jonas Frey, <dev@jonasfrey.de>

# Make sure all system packages are up to date, and install only essential packages.
RUN export DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true \
    && apt-get -q update \
    && apt-get -q dist-upgrade -y \
    && apt-get -q install -y \
      ca-certificates \
      tzdata \
# If your app or its dependencies import FoundationNetworking, also install `libcurl4`.
      libcurl4 \
# If your app or its dependencies import FoundationXML, also install `libxml2`.
      # libxml2 \
    && rm -r /var/lib/apt/lists/* \
    # Create a container user with /home/container as its home directory
    && adduser --disabled-password --gecos "" --home /home/container container

USER container
ENV USER=container HOME=/home/container
WORKDIR /home/container

# Provide configuration needed by the built-in crash reporter and some sensible default behaviors.
export SWIFT_ROOT=/usr
export SWIFT_BACKTRACE=enable=yes,sanitize=yes,threads=all,images=all,interactive=no

# Start the bot
COPY ./entrypoint.sh /entrypoint.sh
CMD ["/bin/bash", "/entrypoint.sh"]
